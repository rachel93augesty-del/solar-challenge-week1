  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: ${{ matrix.python-version }}

  - name: Cache pip
    uses: actions/cache@v4
    with:
      path: ~/.cache/pip
      key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
      restore-keys: |
        ${{ runner.os }}-pip-

  - name: Upgrade pip and build tools
    run: python -m pip install --upgrade pip setuptools wheel

  - name: Install dependencies (if present)
    run: |
      if [ -f requirements.txt ]; then
        # prefer binary wheels first; if that fails, fall back to normal install
        pip install --prefer-binary -r requirements.txt || pip install -r requirements.txt
      else
        echo "No requirements.txt, skipping dependency install"
      fi

  - name: Run tests (if present)
    env:
      PYTHONPATH: .
    run: |
      if [ -d tests ]; then
        # run unittest discovery (only if tests/ exists)
        python -m unittest discover -s tests -p "test_*.py"
      else
        echo "No tests directory, skipping tests"